<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 900">
  <defs>
    <style>
      .box { fill: #fff; stroke: #333; stroke-width: 2; }
      .title { font-family: Arial; font-size: 20px; font-weight: bold; fill: #0D47A1; }
      .label { font-family: Arial; font-size: 14px; font-weight: bold; fill: #333; }
      .text { font-family: Arial; font-size: 12px; fill: #555; }
      .arrow { stroke: #1976D2; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .step { font-family: Arial; font-size: 16px; font-weight: bold; fill: #fff; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976D2" />
    </marker>
  </defs>
  
  <text x="500" y="30" text-anchor="middle" class="title">Real-Time Communication Flow (WebSocket)</text>
  <text x="500" y="50" text-anchor="middle" class="text">Appointment Booking with Live Updates</text>
  
  <!-- Column Headers -->
  <rect x="50" y="80" width="250" height="40" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="105" text-anchor="middle" class="label">Frontend (React)</text>
  
  <rect x="375" y="80" width="250" height="40" class="box" fill="#E8F5E9" rx="5"/>
  <text x="500" y="105" text-anchor="middle" class="label">Backend (Spring Boot)</text>
  
  <rect x="700" y="80" width="250" height="40" class="box" fill="#FFEBEE" rx="5"/>
  <text x="825" y="105" text-anchor="middle" class="label">Database (MySQL)</text>
  
  <!-- Step 1: WebSocket Connection -->
  <circle cx="30" cy="160" r="15" fill="#1976D2"/>
  <text x="30" y="165" text-anchor="middle" class="step">1</text>
  
  <rect x="50" y="140" width="250" height="60" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="165" text-anchor="middle" class="label">WebSocket Connect</text>
  <text x="175" y="185" text-anchor="middle" class="text">stompClient.connect()</text>
  
  <line x1="300" y1="170" x2="375" y2="170" class="arrow"/>
  
  <rect x="375" y="140" width="250" height="60" class="box" fill="#FFF3E0" rx="5"/>
  <text x="500" y="165" text-anchor="middle" class="label">WebSocket Handler</text>
  <text x="500" y="185" text-anchor="middle" class="text">Establish connection</text>
  
  <!-- Step 2: Subscribe -->
  <circle cx="30" cy="250" r="15" fill="#1976D2"/>
  <text x="30" y="255" text-anchor="middle" class="step">2</text>
  
  <rect x="50" y="230" width="250" height="60" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="255" text-anchor="middle" class="label">Subscribe to Topics</text>
  <text x="175" y="275" text-anchor="middle" class="text">/topic/appointments</text>
  
  <line x1="300" y1="260" x2="375" y2="260" class="arrow"/>
  
  <rect x="375" y="230" width="250" height="60" class="box" fill="#FFF3E0" rx="5"/>
  <text x="500" y="255" text-anchor="middle" class="label">Register Subscriptions</text>
  <text x="500" y="275" text-anchor="middle" class="text">Store client subscriptions</text>
  
  <!-- Step 3: Book Appointment -->
  <circle cx="30" cy="340" r="15" fill="#1976D2"/>
  <text x="30" y="345" text-anchor="middle" class="step">3</text>
  
  <rect x="50" y="320" width="250" height="60" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="345" text-anchor="middle" class="label">Book Appointment</text>
  <text x="175" y="365" text-anchor="middle" class="text">POST /api/appointments</text>
  
  <line x1="300" y1="350" x2="375" y2="350" class="arrow"/>
  
  <rect x="375" y="320" width="250" height="60" class="box" fill="#E8F5E9" rx="5"/>
  <text x="500" y="345" text-anchor="middle" class="label">AppointmentController</text>
  <text x="500" y="365" text-anchor="middle" class="text">Validate and Process</text>
  
  <!-- Step 4: Save to Database -->
  <circle cx="30" cy="430" r="15" fill="#1976D2"/>
  <text x="30" y="435" text-anchor="middle" class="step">4</text>
  
  <rect x="375" y="410" width="250" height="60" class="box" fill="#E8F5E9" rx="5"/>
  <text x="500" y="435" text-anchor="middle" class="label">AppointmentService</text>
  <text x="500" y="455" text-anchor="middle" class="text">Create appointment record</text>
  
  <line x1="625" y1="440" x2="700" y2="440" class="arrow"/>
  
  <rect x="700" y="410" width="250" height="60" class="box" fill="#FFEBEE" rx="5"/>
  <text x="825" y="435" text-anchor="middle" class="label">MySQL Database</text>
  <text x="825" y="455" text-anchor="middle" class="text">INSERT INTO appointments</text>
  
  <!-- Step 5: Broadcast -->
  <circle cx="30" cy="520" r="15" fill="#7B1FA2"/>
  <text x="30" y="525" text-anchor="middle" class="step">5</text>
  
  <rect x="375" y="500" width="250" height="70" class="box" fill="#F3E5F5" rx="5"/>
  <text x="500" y="525" text-anchor="middle" class="label">Broadcast Service</text>
  <text x="500" y="545" text-anchor="middle" class="text">Send to /topic/appointments</text>
  <text x="500" y="562" text-anchor="middle" class="text">Notify all subscribers</text>
  
  <!-- Step 6: Receive Update -->
  <circle cx="30" cy="620" r="15" fill="#7B1FA2"/>
  <text x="30" y="625" text-anchor="middle" class="step">6</text>
  
  <line x1="375" y1="535" x2="300" y2="535" class="arrow" stroke="#7B1FA2"/>
  
  <rect x="50" y="600" width="250" height="70" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="625" text-anchor="middle" class="label">Receive Update</text>
  <text x="175" y="645" text-anchor="middle" class="text">onMessage(message)</text>
  <text x="175" y="662" text-anchor="middle" class="text">Parse JSON payload</text>
  
  <!-- Step 7: Update UI -->
  <circle cx="30" cy="720" r="15" fill="#388E3C"/>
  <text x="30" y="725" text-anchor="middle" class="step">7</text>
  
  <rect x="50" y="700" width="250" height="70" class="box" fill="#E3F2FD" rx="5"/>
  <text x="175" y="725" text-anchor="middle" class="label">Update UI (Real-time)</text>
  <text x="175" y="745" text-anchor="middle" class="text">setState(newAppointment)</text>
  <text x="175" y="762" text-anchor="middle" class="text">Show toast notification</text>
  
  <!-- Benefits Box -->
  <rect x="375" y="700" width="575" height="120" class="box" fill="#F5F5F5" rx="5"/>
  <text x="662" y="725" text-anchor="middle" class="label">WebSocket Benefits</text>
  <text x="662" y="750" text-anchor="middle" class="text">Bi-directional communication</text>
  <text x="662" y="770" text-anchor="middle" class="text">Low latency (~10ms)</text>
  <text x="662" y="790" text-anchor="middle" class="text">Persistent connection</text>
  <text x="662" y="810" text-anchor="middle" class="text">Server push capability</text>
  
  <text x="500" y="860" text-anchor="middle" class="label" fill="#7B1FA2">All connected clients receive updates instantly!</text>
</svg>
